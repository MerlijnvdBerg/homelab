# ───────────────────────────────────────────────────────────────
# Global helper (so each vhost block stays short)
# ───────────────────────────────────────────────────────────────
map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}
proxy_set_header  Host               $host;
proxy_set_header  X-Real-IP          $remote_addr;
proxy_set_header  X-Forwarded-For    $proxy_add_x_forwarded_for;
proxy_set_header  X-Forwarded-Proto  $scheme;
proxy_http_version 1.1;
proxy_set_header  Upgrade            $http_upgrade;
proxy_set_header  Connection         $connection_upgrade;

# ───────────────────────────────────────────────────────────────
# Redirect every plain-HTTP request to HTTPS
# ───────────────────────────────────────────────────────────────
server {
    listen 80;
    server_name *.therobo.nl;
    return 301 https://$host$request_uri;
}

# ── jellyfin.therobo.nl ────────────────────────────────────────
upstream jellyfin_up { server jellyfin:8096; }

server {
    listen              443 ssl http2;
    server_name         jellyfin.therobo.nl;

    ssl_certificate     /etc/nginx/certs/live/jellyfin.therobo.nl/fullchain.pem;
    ssl_certificate_key /etc/nginx/certs/live/jellyfin.therobo.nl/privkey.pem;

    location / { proxy_pass http://jellyfin_up; }
}

# ── jellyseerr.therobo.nl ─────────────────────────────────────
upstream jellyseerr_up { server jellyseerr:5055; }

server {
    listen              443 ssl http2;
    server_name         jellyseerr.therobo.nl;

    ssl_certificate     /etc/nginx/certs/live/jellyseerr.therobo.nl/fullchain.pem;
    ssl_certificate_key /etc/nginx/certs/live/jellyseerr.therobo.nl/privkey.pem;

    location / { proxy_pass http://jellyseerr_up; }
}

# …copy-paste/adjust for qbittorrent, sonarr, radarr, readarr, prowlarr,
#   nextcloud, homeassistant, and pihole (change port + cert paths) …
